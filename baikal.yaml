# yaml-language-server: $schema=https://raw.githubusercontent.com/chainguard-dev/apko/refs/heads/main/pkg/build/types/schema.json
include: alpine-base.yaml
contents:
  packages:
    - baikal=0.10.1-r1
    - catatonit
    - nginx
    - php-cgi
    - php-ctype
    - php-dom
    - php-fpm
    - php-iconv
    - php-json
    - php-mbstring
    - php-openssl
    - php-pdo_sqlite
    - php-session
    - php-simplexml
    - php-xml
    - php-xmlreader
    - php-xmlwriter
entrypoint:
  command: catatonit -g --
cmd: sh -c '/usr/sbin/php-fpm* -F & exec /usr/sbin/nginx -e /dev/stderr -g "daemon off;"'
vcs-url: https://github.com/sabre-io/Baikal
accounts:
  groups:
    - groupname: http
      gid: 33
  users:
    - username: http
      uid: 33
  run-as: http
paths:
  - path: /run/nginx
    type: directory
    uid: 33
    gid: 33
    permissions: 0o777
  - path: /var/lib/nginx
    type: directory
    uid: 33
    gid: 33
    permissions: 0o755
    recursive: true
  - path: /var/log
    type: directory
    uid: 33
    gid: 33
    permissions: 0o755
    recursive: true
stop-signal: SIGQUIT
